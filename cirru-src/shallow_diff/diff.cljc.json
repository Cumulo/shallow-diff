[
  [
    "ns",
    "shallow-diff.diff"
  ],
  [
    "declare",
    "diff"
  ],
  [
    "defn",
    "diff-set",
    [
      "xs",
      "ys",
      "coord"
    ],
    [
      "let",
      [
        [
          "all-items",
          [
            "into",
            [
              "hash-set"
            ],
            [
              "concat",
              "xs",
              "ys"
            ]
          ]
        ]
      ],
      [
        "->>",
        "all-items",
        [
          "reduce",
          [
            "fn",
            [
              "cursor"
            ],
            [
              "cond",
              [
                [
                  "and",
                  [
                    "contains?",
                    "xs",
                    "cursor"
                  ],
                  [
                    "not",
                    [
                      "contains?",
                      "ys",
                      "cursor"
                    ]
                  ]
                ],
                [
                  "{}",
                  "coord",
                  [
                    "[]",
                    ":-",
                    "cursor"
                  ]
                ]
              ],
              [
                [
                  "and",
                  [
                    "not",
                    [
                      "contains?",
                      "xs",
                      "cursor"
                    ]
                  ],
                  [
                    "contains?",
                    "ys",
                    "cursor"
                  ]
                ],
                [
                  "{}",
                  "coord",
                  [
                    "[]",
                    ":+",
                    "cursor"
                  ]
                ]
              ],
              [
                ":else",
                [
                  "{}"
                ]
              ]
            ]
          ]
        ],
        [
          "apply",
          "merge"
        ]
      ]
    ]
  ],
  [
    "defn",
    "diff-map",
    [
      "xs",
      "ys",
      "coord"
    ],
    [
      "let",
      [
        [
          "all-keys",
          [
            "into",
            [
              "sorted-set"
            ],
            [
              "concat",
              [
                "keys",
                "xs"
              ],
              [
                "keys",
                "ys"
              ]
            ]
          ]
        ]
      ],
      [
        "->>",
        "all-keys",
        [
          "reduce",
          [
            "fn",
            [
              "acc",
              "cursor"
            ],
            [
              "let",
              [
                [
                  "x",
                  [
                    "get",
                    "xs",
                    "cursor"
                  ]
                ],
                [
                  "y",
                  [
                    "get",
                    "ys",
                    "cursor"
                  ]
                ]
              ],
              [
                "cond",
                [
                  [
                    "identical?",
                    "x",
                    "y"
                  ],
                  [
                    "{}"
                  ]
                ],
                [
                  [
                    "and",
                    [
                      "some?",
                      "x"
                    ],
                    [
                      "not",
                      [
                        "some?",
                        "y"
                      ]
                    ]
                  ],
                  [
                    "{}",
                    "coord",
                    [
                      "[]",
                      ":-",
                      "cursor"
                    ]
                  ]
                ],
                [
                  [
                    "and",
                    [
                      "not",
                      [
                        "some?",
                        "x"
                      ]
                    ],
                    [
                      "some?",
                      "y"
                    ]
                  ],
                  [
                    "{}",
                    "coord",
                    [
                      "[]",
                      ":+",
                      "cursor",
                      "y"
                    ]
                  ]
                ],
                [
                  ":else",
                  [
                    "diff",
                    "x",
                    "y",
                    [
                      "conj",
                      "coord",
                      "cursor"
                    ]
                  ]
                ]
              ]
            ]
          ]
        ],
        [
          "apply",
          "merge"
        ]
      ]
    ]
  ],
  [
    "defn",
    "diff",
    [
      "x",
      "y",
      "coord"
    ],
    [
      "cond",
      [
        [
          "identical?",
          "x",
          "y"
        ],
        [
          "{}"
        ]
      ],
      [
        [
          "and",
          [
            "=",
            [
              "type",
              "x"
            ],
            [
              "type",
              "y"
            ]
          ],
          [
            "set?",
            "x"
          ],
          [
            "sorted?",
            "x"
          ]
        ],
        [
          "diff-set",
          "x",
          "y",
          "coord"
        ]
      ],
      [
        [
          "and",
          [
            "=",
            [
              "type",
              "x"
            ],
            [
              "type",
              "y"
            ]
          ],
          [
            "map?",
            "x"
          ],
          [
            "sorted?",
            "x"
          ]
        ],
        [
          "diff-map",
          "x",
          "y",
          "coord"
        ]
      ],
      [
        ":else",
        [
          "coord",
          [
            "[]",
            ":/",
            "y"
          ]
        ]
      ]
    ]
  ]
]